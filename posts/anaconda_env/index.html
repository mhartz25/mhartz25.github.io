<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Setting up a PyTorch Environment - Matt Hartz</title><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=referrer content="no-referrer"><meta name=description content="some best practices I've found for using Anaconda with ML"><meta property="og:site_name" content="Matt Hartz"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:url" content="https://matthartz.me/posts/anaconda_env/"><meta property="og:title" content="Setting up a PyTorch Environment"><meta property="og:image" content="https://matthartz.me"><meta property="og:description" content="some best practices I've found for using Anaconda with ML"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Setting up a PyTorch Environment"><meta name=twitter:description content="some best practices I've found for using Anaconda with ML"><meta name=twitter:image content="https://matthartz.me"><link rel=canonical href=https://matthartz.me/posts/anaconda_env/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin=anonymous><link rel=stylesheet href=https://matthartz.me/css/custom.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github-gist.min.css integrity="sha512-od7JLoOTxM8w/HSKGzP9Kexc20K9p/M2zxSWsd7H1e4Ctf+8SQFtCWEZnW5u6ul5ehSECa5QmOk9ju2nQMmlVA==" crossorigin=anonymous><link rel="shortcut icon" href=https://matthartz.me/images/favicon.png><link href=https://matthartz.me/index.xml rel=alternate type=application/rss+xml title="Matt Hartz"></head><body><div class="mt-xl header"><div class=container><div class="row justify-content-center"><div class=col-auto><a href=https://matthartz.me><h1 class=name>Matt Hartz</h1></a></div></div><div class="row justify-content-center"><ul class="nav nav-primary"><li class=nav-item><a class=nav-link href=https://matthartz.me/>Home</a></li><li class=nav-item><a class=nav-link href=https://matthartz.me/about/>About</a></li><li class=nav-item><a class=nav-link href=https://github.com/mhartz25>GitHub</a></li><li class=nav-item><a class=nav-link href=https://twitter.com/MattHartz_>Twitter</a></li><li class=nav-item><a class=nav-link href=https://www.linkedin.com/in/matt-hartz/>LinkedIn</a></li></ul></div></div></div><div class=content><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><h1 class="mx-0 mx-md-4">Setting up a PyTorch Environment</h1><div class=markdown><p>It&rsquo;s no secret that setting up a development environment for Machine Learning is a nightmare. There are a lot of tools that try to abstract some of that complexity away, but it&rsquo;s easy to still run into problems(1).</p><p>My tool of choice has been Anaconda. Is it the best? I have no idea, but it&rsquo;s what I&rsquo;ve become most comfortable with(2). I&rsquo;ve banged my head against the wall enough times that I have finally found some success with it. So &ndash; because I’ve learned more than I would ever like to know about managing a python environment with Anaconda &ndash; I decided to write down some of that hard-won knowledge here.</p><h3 id=define-environments-using-yaml>Define Environments Using YAML</h3><p>Defining a YAML file at the start of the project with all the dependencies you think you’ll need and using that to create a new conda environment has been the most useful thing I learned. This method helps to resolve all dependencies and conflicts in one fell swoop. <strong>I have an example file at the bottom of this page</strong></p><p>A few things to be aware of, some packages are not supported by Conda, so these will need to be explicitly defined as a Pip install. There are other workarounds to get conda to build packages, but I have not tried these in the YAML step. The channels portion determines where in the environment packages are downloaded from, for the most part you can ignore this.</p><p>Command: <code>conda env create -f &lt;file_name.yml> -n &lt;env_name></code></p><p>Once you’ve registered your environment, use <code>conda install &lt;package_name></code> wherever possible. Sometimes you will have to use Pip which is fine. But be aware that once you do it breaks conda. Anaconda actually suggests to any do pip installs at the end, and that once you do that if you need to go back to using Conda install you should just recreate a new environment.</p><h3 id=create-a-new-conda-environment-for-each-project>Create a New Conda Environment For Each Project</h3><p>Creating a new conda environment for each project is worth it. An environment per project is probably overkill, but if you’re doing anything with PyTorch or TensorFlow, then I recommend it.</p><p>If you&rsquo;re using Jupyter, you will want to register that environment, be sure to run the following command so that you&rsquo;re Notebook can access that environment:</p><p>Command: <code>python -m ipykernel install --user --name &lt;env_name> --display-name "&lt;display_name>"</code></p><h3 id=yaml-file-example>YAML File Example</h3><pre tabindex=0><code>name: torch
channels:
  - pytorch-nightly
  - conda-forge
dependencies:
    - python=3.9
    - pip&gt;=19.0
    - pytorch 
    - torchvision 
    - jupyter
    - scikit-learn
    - scipy
    - pandas
    - matplotlib
    - pillow
    - tqdm
    - requests
    - h5py
    - pyyaml
    - boto3
    - ipykernel
    - beautifulsoup4
    - transformers
    - datasets
    - gensim
    - numpy
    - pip:
        - bayesian-optimization
        - gym
</code></pre><p>From everything I’ve read python packaging is nowhere close to being solved and even the people who understand what is going on under the hood have trouble. So if you find yourself in python package hell, keep going. When in doubt I rip out the environment and start over.</p><p>If you have any questions or thoughts, always happy to chat about these types of things. My email is mthartz25[at]gmail[dot]com</p><h4 id=footnotes>Footnotes</h4><ol><li>This is completely ignoring managing any jobs in Production, which is a pretty massive omision</li><li>I&rsquo;ve also used some combination of Poetry, pip, and traditional virtual enviornments to varying levels of success</li></ol></div></div></div></div></div><section id=comments><div class="py-3 content"><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><div class=comments><script src=https://utteranc.es/client.js repo issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script></div></div></div></div></div></section><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js defer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js defer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/stan.min.js defer></script>
<script>window.addEventListener("load",function(){hljs.initHighlighting()},!0)</script></body></html>